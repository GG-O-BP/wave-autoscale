name: test_on_pull_request
run-name: ${{ github.actor }} has created a pull request
on:
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'     
        required: true
        default: 'warning'
      tags:
        description: 'Test scenario tags'

env:
  CARGO_TERM_COLOR: always

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Set up cargo cache
      uses: actions/cache@v3
      continue-on-error: false
      with:
        path: |
          ~/.cargo/bin/
          ~/.cargo/registry/index/
          ~/.cargo/registry/cache/
          ~/.cargo/git/db/
          target/            
        key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: ${{ runner.os }}-cargo-
      
#     - name: Install Rust
#       uses: actions-rs/toolchain@v1
#       with:
#         profile: minimal
#         toolchain: stable
#         override: true
#         components: rustfmt, clippy
  
    - name: Install Moonrepo
      uses: moonrepo/setup-moon-action@v1
  
    - name: Check versions
      run: rustc --version
      
    - name: Run tests
      run: cargo test --verbose
